<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>AR Game</title>

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

  <!-- AR.js -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>

<body style="margin:0; overflow:hidden;">

<!-- UI -->
<div style="
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  text-align: center;
">
  <button id="countBtn" style="font-size:20px; padding:10px 20px;">
    Click me!
  </button>
  <p style="color:white;">Score: <span id="score">0</span>/10</p>
</div>

<a-scene embedded arjs renderer="logarithmicDepthBuffer: true;">

  <!-- LUCES -->
  <a-entity light="type: ambient; intensity: 0.7"></a-entity>
  <a-entity light="type: directional; intensity: 0.8" position="1 2 1"></a-entity>

  <!-- MARKER -->
  <a-marker preset="hiro" id="marker">

    <!-- MODELO -->
    <a-entity
      id="fakemogus"
      gltf-model="url(materiales/fakemogus.glb)"
      scale="0.5 0.5 0.5"
      rotation="0 180 0"
      animation-mixer="clip: take.001; autoplay: false; loop: once; clampWhenFinished: true"
      sound="src: url(materiales/click.mp3); volume: 1">
    </a-entity>

    <!-- IMAGEN +1 -->
    <a-image
      id="plus"
      src="materiales/plus1.png"
      position="0 -0.3 0"
      scale="0.15 0.15 0.15"
      material="transparent: true; opacity: 0">
    </a-image>

  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<script>
let score = 0;
let modelReady = false;

const btn = document.getElementById("countBtn");
const scoreDisplay = document.getElementById("score");

const model = document.getElementById("fakemogus");
const plus = document.getElementById("plus");

// esperar a que cargue el modelo
model.addEventListener("model-loaded", () => {
  modelReady = true;
  console.log("Modelo cargado");
});

btn.addEventListener("click", () => {
  if (!modelReady) return;

  score++;
  scoreDisplay.textContent = score;

  // ðŸŽ¬ ANIMACIÃ“N (reinicio limpio)
  const mixer = model.components["animation-mixer"].mixer;
  mixer.setTime(0);
  mixer.update(0);
  mixer.timeScale = 1;

  // ðŸ”Š SONIDO
  model.components.sound.stopSound();
  model.components.sound.playSound();

  // âœ¨ +1 IMAGEN
  plus.setAttribute("material", "opacity", 1);
  plus.setAttribute("position", "0 -0.3 0");
  plus.setAttribute("scale", "0.15 0.15 0.15");

  plus.setAttribute("animation__move", {
    property: "position",
    to: "0 0.3 0",
    dur: 600,
    easing: "easeOutQuad"
  });

  plus.setAttribute("animation__scale", {
    property: "scale",
    to: "0.3 0.3 0.3",
    dur: 600,
    easing: "easeOutQuad"
  });

  plus.setAttribute("animation__fade", {
    property: "material.opacity",
    to: 0,
    dur: 600
  });
});
</script>

</body>
</html>
